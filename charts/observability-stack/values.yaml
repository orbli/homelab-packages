# Fixed values for observability-stack with proper storage configuration

# Values for kube-prometheus-stack
kubePrometheusStack:
  enabled: true
  
  # Prometheus configuration with WORKING storage
  prometheus:
    prometheusSpec:
      retention: 30d
      retentionSize: "50GB"
      
      # THIS IS THE FIX - Enable persistence
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: k8s-csi
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 100Gi
      
      # Resources
      resources:
        requests:
          memory: 2Gi
          cpu: 500m
        limits:
          memory: 4Gi
          cpu: 2
      
      # Service monitor selectors
      serviceMonitorSelectorNilUsesHelmValues: false
      podMonitorSelectorNilUsesHelmValues: false
      ruleSelectorNilUsesHelmValues: false
  
  # Grafana configuration
  grafana:
    enabled: true
    
    # Admin credentials
    # Leave adminPassword empty to auto-generate a random password
    # Or set it to override with your own password
    adminPassword: ""  # Auto-generates if empty
    
    # Use the generated secret for admin credentials
    admin:
      existingSecret: "observability-stack-grafana-admin"
    
    persistence:
      enabled: true
      type: pvc
      storageClassName: k8s-csi
      size: 10Gi
    
    grafana.ini:
      server:
        domain: grafana.observability-test.svc.cluster.local
        root_url: "%(protocol)s://%(domain)s/"
      analytics:
        check_for_updates: false
        reporting_enabled: false
    
    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
        - name: Prometheus
          type: prometheus
          url: http://observability-stack-kube-p-prometheus:9090
          access: proxy
          isDefault: true
  
  # AlertManager configuration with WORKING storage
  alertmanager:
    enabled: true
    alertmanagerSpec:
      # THIS IS THE FIX - Correct path for alertmanager storage
      storage:
        volumeClaimTemplate:
          spec:
            storageClassName: k8s-csi
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 10Gi
      
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 200m
          memory: 256Mi
  
  # Node exporter configuration
  nodeExporter:
    enabled: true
  
  # Kube state metrics configuration
  kubeStateMetrics:
    enabled: true